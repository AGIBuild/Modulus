@page "/components"
@page "/components/{DemoId}"
@using Modulus.UI.Blazor.Components
@using Modulus.UI.Abstractions

<MudGrid>
    <!-- Demo Navigation Sidebar - Using UI Library NavigationMenu -->
    <MudItem xs="12" sm="3">
        <MudPaper Elevation="2" Class="pa-4" Style="height: 100%;">
            <MudText Typo="Typo.h6" Class="mb-4">Component Demos</MudText>
            <NavigationMenu Items="@_demoItems" OnItemClicked="OnDemoSelected" />
        </MudPaper>
    </MudItem>
    
    <!-- Demo Content Area -->
    <MudItem xs="12" sm="9">
        <MudPaper Elevation="2" Class="pa-6">
            <MudText Typo="Typo.h4" Class="mb-2">@_viewModel.CurrentDemoName</MudText>
            <MudDivider Class="mb-4" />
            
            @switch (_currentDemoId)
            {
                case "nav-demo":
                    <NavigationDemo />
                    break;
                case "badge-demo":
                    <BadgeDemo />
                    break;
                case "disabled-demo":
                    <DisabledDemo />
                    break;
                case "sub-item-1":
                case "sub-item-2":
                case "sub-item-3":
                    <SubItemDemo ItemId="@_currentDemoId" />
                    break;
                case "context-demo":
                    <ContextMenuDemo />
                    break;
                case "keyboard-demo":
                    <KeyboardDemo />
                    break;
                case "lifecycle-demo":
                    <LifecycleDemo />
                    break;
                default:
                    <NavigationDemo />
                    break;
            }
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    [Parameter]
    public string? DemoId { get; set; }

    private ComponentsMainViewModel _viewModel = new();
    private string _currentDemoId = "nav-demo";
    private IEnumerable<MenuItem> _demoItems = Enumerable.Empty<MenuItem>();

    protected override void OnInitialized()
    {
        // Transform NavigationKey to full path for NavigationMenu
        _demoItems = _viewModel.DemoItems.Select(TransformMenuItem).ToList();
    }

    protected override void OnParametersSet()
    {
        _currentDemoId = DemoId ?? "nav-demo";
        _viewModel.NavigateTo(_currentDemoId);
    }

    private MenuItem TransformMenuItem(MenuItem item)
    {
        // Create new MenuItem with full navigation path
        return new MenuItem(
            item.Id,
            item.DisplayName,
            item.Icon,
            $"/components/{item.NavigationKey}",
            item.Location,
            item.Order)
        {
            IsEnabled = item.IsEnabled,
            BadgeCount = item.BadgeCount,
            BadgeColor = item.BadgeColor,
            IsExpanded = item.IsExpanded,
            Children = item.Children?.Select(TransformMenuItem).ToList()
        };
    }

    private void OnDemoSelected(MenuItem item)
    {
        // Extract demo ID from navigation key (remove /components/ prefix)
        var demoId = item.NavigationKey?.Replace("/components/", "") ?? "nav-demo";
        _currentDemoId = demoId;
        _viewModel.NavigateTo(demoId);
    }
}

