@inject Modulus.UI.Abstractions.IMenuRegistry MenuRegistry

<MudDrawer @bind-Open="IsOpen" ClipMode="DrawerClipMode.Always" Elevation="2" 
           Variant="@DrawerVariant.Responsive" Breakpoint="Breakpoint.Md">
    <div class="drawer-content">
        <!-- Top Section: Header + Main Menu -->
        <div class="drawer-top">
            <MudDrawerHeader>
                <MudText Typo="Typo.h6">Navigation</MudText>
            </MudDrawerHeader>
            <MudNavMenu Bordered="true" Color="Color.Primary">
                <!-- Static Home -->
                <MudNavLink Href="/" Icon="@MudBlazor.Icons.Material.Filled.Home" Match="NavLinkMatch.All">
                    Home
                </MudNavLink>
                
                <!-- Dynamic Main Menu Items -->
                @foreach (var item in _mainMenuItems)
                {
                    <MudNavLink Href="@item.NavigationKey" Icon="@GetIcon(item.Icon)" Match="NavLinkMatch.Prefix">
                        @item.DisplayName
                    </MudNavLink>
                }
            </MudNavMenu>
        </div>
        
        <!-- Bottom Section: Bottom Menu Items -->
        <div class="drawer-bottom">
            <MudDivider Class="mb-2" />
            <MudNavMenu Bordered="true" Color="Color.Primary">
                @foreach (var item in _bottomMenuItems)
                {
                    <MudNavLink Href="@item.NavigationKey" Icon="@GetIcon(item.Icon)" Match="NavLinkMatch.Prefix">
                        @item.DisplayName
                    </MudNavLink>
                }
            </MudNavMenu>
        </div>
    </div>
</MudDrawer>

<style>
    .drawer-content {
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    .drawer-top {
        flex: 1;
        overflow-y: auto;
    }
    
    .drawer-bottom {
        flex-shrink: 0;
        padding-bottom: 8px;
    }
</style>

@code {
    [Parameter]
    public bool IsOpen { get; set; } = true;

    [Parameter]
    public EventCallback<bool> IsOpenChanged { get; set; }

    private List<Modulus.UI.Abstractions.MenuItem> _mainMenuItems = new();
    private List<Modulus.UI.Abstractions.MenuItem> _bottomMenuItems = new();

    protected override void OnInitialized()
    {
        RefreshMenuItems();
    }

    private void RefreshMenuItems()
    {
        _mainMenuItems = MenuRegistry.GetItems(Modulus.UI.Abstractions.MenuLocation.Main).ToList();
        _bottomMenuItems = MenuRegistry.GetItems(Modulus.UI.Abstractions.MenuLocation.Bottom).ToList();
    }

    private string GetIcon(string iconName)
    {
        return iconName?.ToLower() switch
        {
            "extension" or "modules" => MudBlazor.Icons.Material.Filled.Extension,
            "settings" or "gear" => MudBlazor.Icons.Material.Filled.Settings,
            "home" => MudBlazor.Icons.Material.Filled.Home,
            "note" or "notes" => MudBlazor.Icons.Material.Filled.Note,
            "echo" or "voice" => MudBlazor.Icons.Material.Filled.RecordVoiceOver,
            "dashboard" => MudBlazor.Icons.Material.Filled.Dashboard,
            "person" or "user" => MudBlazor.Icons.Material.Filled.Person,
            "search" => MudBlazor.Icons.Material.Filled.Search,
            "info" => MudBlazor.Icons.Material.Filled.Info,
            "help" => MudBlazor.Icons.Material.Filled.Help,
            "folder" => MudBlazor.Icons.Material.Filled.Folder,
            "file" => MudBlazor.Icons.Material.Filled.InsertDriveFile,
            "code" => MudBlazor.Icons.Material.Filled.Code,
            "chat" => MudBlazor.Icons.Material.Filled.Chat,
            "mail" or "email" => MudBlazor.Icons.Material.Filled.Mail,
            "calendar" => MudBlazor.Icons.Material.Filled.CalendarMonth,
            "star" => MudBlazor.Icons.Material.Filled.Star,
            "favorite" or "heart" => MudBlazor.Icons.Material.Filled.Favorite,
            _ => MudBlazor.Icons.Material.Filled.Circle
        };
    }
}

