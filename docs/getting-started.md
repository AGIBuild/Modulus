# Getting Started with Modulus

This guide will walk you through setting up your development environment, creating your first module, and running it in the Modulus host.

## Prerequisites

- **.NET 9 SDK** or later
- **IDE**: Visual Studio 2022, JetBrains Rider, or VS Code
- **Git** (optional, for cloning the repository)

## Installation

### Option 1: Install CLI from NuGet (Recommended)

```bash
# Install the Modulus CLI globally
dotnet tool install -g Agibuild.Modulus.Cli

# Verify installation
modulus --help
```

### Option 2: Install Project Templates

```bash
# Install module project templates
dotnet new install Agibuild.Modulus.Templates

# Verify templates are installed
dotnet new list modulus
```

You should see:

```
Template Name                Short Name        Language  Tags
---------------------------  ----------------  --------  --------------------------------
Modulus Module (Avalonia)    modulus-avalonia  [C#]      Modulus/Module/Plugin/Avalonia
Modulus Module (Blazor)      modulus-blazor    [C#]      Modulus/Module/Plugin/Blazor
```

### Option 3: Build from Source

```bash
# Clone the repository
git clone https://github.com/user/Modulus.git
cd Modulus

# Build the solution
dotnet build

# Run the Avalonia host
dotnet run --project src/Hosts/Modulus.Host.Avalonia
```

## Quick Start: Create Your First Module

### Step 1: Create a New Module

Using the CLI:

```bash
modulus new -n MyFirstModule
cd MyFirstModule
```

Or using dotnet new:

```bash
dotnet new modulus-avalonia -n MyFirstModule
cd MyFirstModule
```

This creates a module with the following structure:

```
MyFirstModule/
├── MyFirstModule.sln              # Solution file
├── .gitignore
├── MyFirstModule.Core/            # Core logic (host-agnostic)
│   ├── MyFirstModule.Core.csproj
│   ├── MyFirstModuleModule.cs     # Module entry point
│   └── ViewModels/
│       └── MainViewModel.cs       # Main ViewModel
└── MyFirstModule.UI.Avalonia/     # Avalonia UI
    ├── MyFirstModule.UI.Avalonia.csproj
    ├── MyFirstModuleAvaloniaModule.cs
    ├── MainView.axaml             # UI definition
    └── MainView.axaml.cs
```

### Step 2: Build the Module

```bash
modulus build
```

Or:

```bash
dotnet build
```

### Step 3: Package for Distribution

```bash
modulus pack
```

This creates a `.modpkg` file in the `./output/` directory.

### Step 4: Install the Module

```bash
modulus install ./output/MyFirstModule-1.0.0.modpkg
```

### Step 5: Run the Host

```bash
# If you have the Modulus host installed
modulus-host

# Or run from the Modulus source
dotnet run --project path/to/Modulus/src/Hosts/Modulus.Host.Avalonia
```

Your module will appear in the sidebar!

## Module Development Workflow

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Create    │────▶│    Build    │────▶│    Pack     │
│ modulus new │     │modulus build│     │ modulus pack│
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│    Run      │◀────│   Install   │◀────│   Output    │
│  Host App   │     │modulus inst.│     │  .modpkg    │
└─────────────┘     └─────────────┘     └─────────────┘
```

## Understanding the Module Structure

### Core Project (`*.Core`)

Contains the business logic, ViewModels, and services. This code is **host-agnostic** and runs on both Avalonia and Blazor hosts.

Key files:

- **`*Module.cs`**: The module entry point, extends `ModulusPackage`
- **`ViewModels/`**: MVVM ViewModels for your module
- **`Services/`**: Business logic services (you add these)

### UI Projects (`*.UI.Avalonia` / `*.UI.Blazor`)

Contains the UI implementation for each host platform.

- **Avalonia**: Uses `.axaml` files for XAML-based UI
- **Blazor**: Uses `.razor` files for component-based UI

### Module Manifest (`extension.vsixmanifest`)

The manifest file is automatically generated by the template and contains:

```xml
<PackageManifest Version="2.0.0">
  <Metadata>
    <Identity Id="unique-guid" Version="1.0.0" Publisher="YourName" />
    <DisplayName>MyFirstModule</DisplayName>
    <Description>Module description</Description>
  </Metadata>
  <Assets>
    <!-- Module assemblies -->
    <Asset Type="Modulus.Package" Path="MyFirstModule.Core.dll" />

    <!-- Host-specific UI packages -->
    <Asset Type="Modulus.Package" Path="MyFirstModule.UI.Avalonia.dll" TargetHost="Modulus.Host.Avalonia" />
    <Asset Type="Modulus.Package" Path="MyFirstModule.UI.Blazor.dll" TargetHost="Modulus.Host.Blazor" />
    
    <!-- Menu declarations are NOT in the manifest anymore.
         Menus are declared via [AvaloniaMenu]/[BlazorMenu] on the host-specific module entry type
         and projected to the database at install/update time. -->
  </Assets>
</PackageManifest>
```

## CLI Command Reference

| Command | Description |
|---------|-------------|
| `modulus new <name>` | Create a new module project |
| `modulus build` | Build the module in current directory |
| `modulus pack` | Build and package as .modpkg |
| `modulus install <source>` | Install a module from .modpkg or directory |
| `modulus uninstall <name>` | Uninstall a module |
| `modulus list` | List installed modules |

### modulus new

```bash
modulus new MyModule [options]

Options:
  -t, --target <avalonia|blazor>  Target host platform
  -d, --display-name <name>       Display name in menus
  -p, --publisher <name>          Publisher name
  -i, --icon <icon>               Menu icon (e.g., Folder, Home, Settings)
  --output <path>                 Output directory
  --force                         Overwrite existing files
```

### modulus build

```bash
modulus build [options]

Options:
  -p, --path <path>               Path to module project
  -c, --configuration <config>    Build configuration (default: Release)
  -v, --verbose                   Show detailed output
```

### modulus pack

```bash
modulus pack [options]

Options:
  -p, --path <path>               Path to module project
  -o, --output <path>             Output directory (default: ./output)
  -c, --configuration <config>    Build configuration (default: Release)
  --no-build                      Skip build, use existing output
  -v, --verbose                   Show detailed output
```

### modulus install

```bash
modulus install <source> [options]

Arguments:
  <source>    Path to .modpkg file or module directory

Options:
  -f, --force    Overwrite existing installation
  -v, --verbose  Show detailed output
```

## Next Steps

- [Module Development Guide](./module-development.md) - Deep dive into module development
- [CLI Reference](./cli-reference.md) - Complete CLI command reference
- [Manifest Format](./manifest-format.md) - Understanding extension.vsixmanifest
- [UI Components](./ui-components.md) - Available UI components and styling

## Troubleshooting

### "Module not found" after installation

Restart the Modulus host application. Modules are loaded at startup.

### Build errors with NuGet packages

Ensure you have the latest Modulus SDK packages:

```bash
dotnet restore
```

### Module not appearing in menu

Check that your host-specific module entry type declares a menu attribute:

- Avalonia: `[AvaloniaMenu("key", "Display", typeof(MainViewModel), ...)]`
- Blazor: `[BlazorMenu("key", "Display", "/route", ...)]`

Menus are read from the database at render time. If you upgraded from an older build, delete the host database file and restart.

## Getting Help

- GitHub Issues: [Report bugs or request features](https://github.com/user/Modulus/issues)
- Discussions: [Ask questions](https://github.com/user/Modulus/discussions)

